(function(){"use strict";BX.namespace("BX.Currency");var e=null;function t(){if(e===null){e=BX.message("CURRENCY")}return e}BX.Currency.Editor=function(e){this.input=e.input;this.callback=e.callback;this.currency=e.currency;this.value=e.value||"";BX.ready(BX.delegate(this.init,this))};BX.Currency.Editor.prototype.init=function(){BX.bind(this.input,"bxchange",BX.proxy(this.valueEdit,this));BX.unbind(this.input,"change",BX.proxy(this.valueEdit,this))};BX.Currency.Editor.prototype.clean=function(){BX.unbind(this.input,"bxchange",BX.proxy(this.valueEdit,this));this.input=null};BX.Currency.Editor.prototype.valueEdit=function(){this.formatValue()};BX.Currency.Editor.prototype.setCurrency=function(e){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.currency=e;this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.formatValue=function(){var e=BX.getCaretPosition(this.input);var t=this.input.value;this.changeValue();if(this.input.value.length>0){BX.setCaretPosition(this.input,e-t.length+this.input.value.length)}};BX.Currency.Editor.prototype.changeValue=function(){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.callValueChangeCallback=function(){if(!!this.callback){this.callback.apply(this,[this.value])}BX.onCustomEvent(this,"Currency::Editor::change",[this.value])};BX.Currency.Editor.getBaseCurrencyId=function(){var e=t();for(var r in e){if(!e.hasOwnProperty(r)){continue}if(BX.prop.getString(e[r],"BASE","N")==="Y"){return r}}return""};BX.Currency.Editor.trimTrailingZeros=function(e,r){var i=t();if(typeof i[r]==="undefined"){return e}var n=BX.prop.getString(i[r],"DEC_POINT","");return n!==""?e.replace(new RegExp("\\"+n+"0+$"),""):e};BX.Currency.Editor.escapeRegExp=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};BX.Currency.Editor.getUnFormattedValue=function(e,r){var i=t();if(i[r]["SEPARATOR"].length===1){return e.replace(new RegExp("["+i[r]["SEPARATOR"]+"]","g"),"").replace(i[r]["DEC_POINT"],".")}else{return e.replace(new RegExp(this.escapeRegExp(i[r]["SEPARATOR"]),"g"),"").replace(i[r]["DEC_POINT"],".")}};BX.Currency.Editor.getFormattedValue=function(e,r){var i=e.length;var n="";var u=t();if(i>0){e=e.replace(/^0+/,"");if(e.length<=0){e="0"}else if(e.charAt(0)==="."){e="0"+e}i=e.length}var a;if(u[r]["SEPARATOR"]===","||u[r]["SEPARATOR"]==="."){a=new RegExp("[.,]")}else{a=new RegExp("["+u[r]["DEC_POINT"]+",.]")}var l=e.match(a);l=l===null?e.length:l.index;var c=0;for(var h=0;h<e.length;h++){var o=e.length-1-h;var s=e.charAt(o);var p="0123456789".indexOf(s)>=0;if(p){c++}if(o===l){c=0}if(o>=l){if(u[r]["DEC_POINT"]==="."&&s===","){s=u[r]["DEC_POINT"]}if(u[r]["DEC_POINT"]===","&&s==="."){s=u[r]["DEC_POINT"]}if(p||o===l&&s===u[r]["DEC_POINT"]){n=s+n}else if(i>o){i--}}else{if(p){n=s+n}else if(i>o){i--}if(p&&c%3===0&&c!==0&&o!==0){n=u[r]["SEPARATOR"]+n;if(i>=o){i++}}}}if(u[r]["DECIMALS"]>0){l=n.match(new RegExp("["+u[r]["DEC_POINT"]+"]"));l=l===null?n.length:l.index;while(n.length-1-l>u[r]["DECIMALS"]){if(i>=n.length-1){i--}n=n.substr(0,n.length-1)}}return n}})();