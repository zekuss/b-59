function hideFilterValueAction(e){"undefined"==typeof layered_hidden_list[$(e).parent().find("ul").attr("id")]||0==layered_hidden_list[$(e).parent().find("ul").attr("id")]?($(e).parent().find(".hiddable").hide(),$(e).parent().find(".hide-action.less").hide(),$(e).parent().find(".hide-action.more").show()):($(e).parent().find(".hiddable").show(),$(e).parent().find(".hide-action.less").show(),$(e).parent().find(".hide-action.more").hide())}function addSlider(e,t,r,a){sliderList.push({type:e,data:t,unit:r,format:a})}function initSliders(){$(sliderList).each(function(e,t){$("#layered_"+t.type+"_slider").slider(t.data);var r="",a="";switch(t.format){case 1:case 2:case 3:case 4:r=blocklayeredFormatCurrency($("#layered_"+t.type+"_slider").slider("values",0),t.format,t.unit),a=blocklayeredFormatCurrency($("#layered_"+t.type+"_slider").slider("values",1),t.format,t.unit);break;case 5:r=$("#layered_"+t.type+"_slider").slider("values",0)+t.unit,a=$("#layered_"+t.type+"_slider").slider("values",1)+t.unit}$("#layered_"+t.type+"_range").html(r+" - "+a)})}function initLayered(){if(initSliders(),initLocationChange(),updateProductUrl(),2==window.location.href.split("#").length&&""!=window.location.href.split("#")[1]){var e=window.location.href.split("#")[1];reloadContent("&selected_filters="+e)}}function paginationButton(){$("div.pagination a").not(":hidden").each(function(){if(-1==$(this).attr("href").search(/[&|\?]p=/))var e=1;else var e=$(this).attr("href").replace(/^.*[&|\?]p=(\d+).*$/,"$1");var t=window.location.href.replace(/#.*$/,"");$(this).attr("href",t+current_friendly_url.replace(/\/page-(\d+)/,"")+"/page-"+e)}),$("div.pagination li").not(".current, .disabled").each(function(){var e=0;$(this).hasClass("pagination_next")?e=parseInt($("div.pagination li.current").children().html())+1:$(this).hasClass("pagination_previous")&&(e=parseInt($("div.pagination li.current").children().html())-1),$(this).children().click(function(){return p=0==e?parseInt($(this).html())+parseInt(e):e,p="&p="+p,reloadContent(p),e=0,!1})})}function cancelFilter(){$("#enabled_filters a").live("click",function(e){$(this).attr("rel").search(/_slider$/)>0?$("#"+$(this).attr("rel")).length?($("#"+$(this).attr("rel")).slider("values",0,$("#"+$(this).attr("rel")).slider("option","min")),$("#"+$(this).attr("rel")).slider("values",1,$("#"+$(this).attr("rel")).slider("option","max")),$("#"+$(this).attr("rel")).slider("option","slide")(0,{values:[$("#"+$(this).attr("rel")).slider("option","min"),$("#"+$(this).attr("rel")).slider("option","max")]})):$("#"+$(this).attr("rel").replace(/_slider$/,"_range_min")).length&&($("#"+$(this).attr("rel").replace(/_slider$/,"_range_min")).val($("#"+$(this).attr("rel").replace(/_slider$/,"_range_min")).attr("limitValue")),$("#"+$(this).attr("rel").replace(/_slider$/,"_range_max")).val($("#"+$(this).attr("rel").replace(/_slider$/,"_range_max")).attr("limitValue"))):$("option#"+$(this).attr("rel")).length?$("#"+$(this).attr("rel")).parent().val(""):($("#"+$(this).attr("rel")).attr("checked",!1),$("."+$(this).attr("rel")).attr("checked",!1),$("#layered_form input[type=hidden][name="+$(this).attr("rel")+"]").remove()),reloadContent(),e.preventDefault()})}function openCloseFilter(){$("#layered_form span.layered_close a").live("click",function(e){'<i class="icon-plus-sign"></i>'==$(this).html()?($("#"+$(this).attr("rel")).show(600),$(this).html('<i class="icon-minus-sign"></i>'),$(this).parent().removeClass("closed")):($("#"+$(this).attr("rel")).hide(600),$(this).html('<i class="icon-plus-sign"></i>'),$(this).parent().addClass("closed")),e.preventDefault()})}function stopAjaxQuery(){for("undefined"==typeof ajaxQueries&&(ajaxQueries=new Array),i=0;i<ajaxQueries.length;i++)ajaxQueries[i].abort();ajaxQueries=new Array}function reloadContent(e){if(stopAjaxQuery(),ajaxLoaderOn||($("#product_list").prepend($("#layered_ajax_loader").html()),$("#product_list").css("opacity","0.7"),ajaxLoaderOn=1),data=$("#layered_form").serialize(),$(".layered_slider").each(function(){var e=$(this).slider("values",0),t=$(this).slider("values",1);"number"==typeof e&&"number"==typeof t&&(data+="&"+$(this).attr("id")+"="+e+"_"+t)}),$(["price","weight"]).each(function(e,t){$("#layered_"+t+"_range_min").length&&(data+="&layered_"+t+"_slider="+$("#layered_"+t+"_range_min").val()+"_"+$("#layered_"+t+"_range_max").val())}),$("#layered_form .select option").each(function(){$(this).attr("id")&&$(this).parent().val()==$(this).val()&&(data+="&"+$(this).attr("id")+"="+$(this).val())}),$(".selectProductSort").length&&$(".selectProductSort").val()){if($(".selectProductSort").val().search(/orderby=/)>0)var t=[$(".selectProductSort").val().match(/orderby=(\w*)/)[1],$(".selectProductSort").val().match(/orderway=(\w*)/)[1]];else var t=$(".selectProductSort").val().split(":");data+="&orderby="+t[0]+"&orderway="+t[1]}$(".js-nb_item").length&&(data+="&n="+$(".js-nb_item").val());var r=!0;void 0==e&&(e="",r=!1);var a="";$("div.pagination .js-nb_item").children().each(function(e,t){t.selected&&(a="&n="+t.value)}),ajaxQuery=$.ajax({type:"GET",url:baseDir+"modules/blocklayered/blocklayered-ajax.php",data:data+e+a,dataType:"json",cache:!1,success:function(e){$("#layered_block_left").replaceWith(utf8_decode(e.filtersBlock)),$(".category-product-count").html(e.categoryCount),e.productList?$("#product_list").replaceWith(utf8_decode(e.productList)):$("#product_list").html(""),$("#product_list").css("opacity","1"),$.browser.msie&&$("#product_list").css("filter",""),e.pagination.search(/[^\s]/)>=0?$(e.pagination).find("ul.pagination").length?($("div.pagination").show(),$("ul.pagination").each(function(){$(this).replaceWith($(e.pagination).find("ul.pagination"))})):$("ul.pagination").length?($("ul.pagination").html(""),$("div.pagination").hide()):($("div.pagination").show(),$("div.pagination").each(function(){$(this).html($(e.pagination))})):($("ul.pagination").html(""),$("div.pagination").hide()),paginationButton(),ajaxLoaderOn=0,$("div.pagination form").submit(function(){return val=$("div.pagination .js-nb_item").val(),$("div.pagination .js-nb_item").children().each(function(e,t){t.value==val?$(t).attr("selected",!0):$(t).removeAttr("selected")}),reloadContent(),!1}),"undefined"!=typeof ajaxCart&&ajaxCart.overrideButtonsInThePage(),"function"==typeof reloadProductComparison&&reloadProductComparison(),initSliders(),"undefined"==typeof current_friendly_url&&(current_friendly_url="#"),$(["price","weight"]).each(function(e,t){$("#layered_"+t+"_slider").length?"object"!=typeof $("#layered_"+t+"_slider").slider("values",0)&&($("#layered_"+t+"_slider").slider("values",0)!=$("#layered_"+t+"_slider").slider("option","min")||$("#layered_"+t+"_slider").slider("values",1)!=$("#layered_"+t+"_slider").slider("option","max"))&&(current_friendly_url+="/"+t+"-"+$("#layered_"+t+"_slider").slider("values",0)+"-"+$("#layered_"+t+"_slider").slider("values",1)):$("#layered_"+t+"_range_min").length&&(current_friendly_url+="/"+t+"-"+$("#layered_"+t+"_range_min").val()+"-"+$("#layered_"+t+"_range_max").val())}),"#"==current_friendly_url&&(current_friendly_url="#/"),window.location=current_friendly_url,lockLocationChecking=!0,r&&$.scrollTo(".sortPagiBar",400),$(function(){$("#layered_form .store_list_filter input.checkbox, .compare .comparator, #productsSortForm .selectProductSort, .nb_item").uniform()}),$("#enabled_filters li a").hover(function(){$(this).parent().addClass("enabled_filters_extra")},function(){$(this).parent().removeClass("enabled_filters_extra")}),r&&$.scrollTo(".sortPagiBar",400),updateProductUrl(),$(".hide-action").each(function(){hideFilterValueAction(this)})}}),ajaxQueries.push(ajaxQuery)}function initLocationChange(e,t){t||(t=500);var r=getUrlParams();setInterval(function(){if(getUrlParams()==r||lockLocationChecking)lockLocationChecking=!1,r=getUrlParams();else{if(r.replace(/^#(\/)?/,"")==getUrlParams().replace(/^#(\/)?/,""))return;lockLocationChecking=!0,reloadContent("&selected_filters="+getUrlParams().replace(/^#/,""))}},t)}function getUrlParams(){var e=current_friendly_url;return 2==window.location.href.split("#").length&&""!=window.location.href.split("#")[1]&&(e="#"+window.location.href.split("#")[1]),e}function updateProductUrl(){"undefined"!=typeof param_product_url&&""!=param_product_url&&"#"!=param_product_url&&$.each($("ul#product_list li.ajax_block_product .product_img_link,ul#product_list li.ajax_block_product h3 a,ul#product_list li.ajax_block_product .product_desc a,ul#product_list li.ajax_block_product .lnk_view"),function(){$(this).attr("href",$(this).attr("href")+param_product_url)})}function utf8_decode(e){for(var t="",r=0;r<e.length;){var a=e.charCodeAt(r);if(128>a)t+=String.fromCharCode(a),r++;else if(a>191&&224>a){var i=e.charCodeAt(r+1);t+=String.fromCharCode((31&a)<<6|63&i),r+=2}else{var i=e.charCodeAt(r+1),n=e.charCodeAt(r+2);t+=String.fromCharCode((15&a)<<12|(63&i)<<6|63&n),r+=3}}return t}function blocklayeredFormatCurrency(e,t,r,a){return blank="",e=parseFloat(e.toFixed(6)),e=ps_round(e,priceDisplayPrecision),a>0&&(blank=" "),1==t?r+blank+blocklayeredFormatNumber(e,priceDisplayPrecision,",","."):2==t?blocklayeredFormatNumber(e,priceDisplayPrecision," ",",")+blank+r:3==t?r+blank+blocklayeredFormatNumber(e,priceDisplayPrecision,".",","):4==t?blocklayeredFormatNumber(e,priceDisplayPrecision,",",".")+blank+r:e}function blocklayeredFormatNumber(e,t,r,a){e=e.toFixed(t);for(var i=e+"",n=i.split("."),l=2==n.length?n[0]:i,o=("0."+(2==n.length?n[1]:0)).substr(2),d=l.length,s=1;4>s;s++)e>=Math.pow(10,3*s)&&(l=l.substring(0,d-3*s)+r+l.substring(d-3*s));return 0==parseInt(t)?l:l+a+(o>0?o:"00")}var ajaxQueries=new Array,ajaxLoaderOn=0,sliderList=new Array,slidersInit=!1;$(document).ready(function(){cancelFilter(),openCloseFilter(),$("#layered_form input[type=button], #layered_form label.layered_color").live("click",function(){$("input[name="+$(this).attr("name")+"][type=hidden]").length?$("input[name="+$(this).attr("name")+"][type=hidden]").remove():$("<input />").attr("type","hidden").attr("name",$(this).attr("name")).val($(this).attr("rel")).appendTo("#layered_form"),reloadContent()}),$("#layered_form input[type=checkbox], #layered_form input[type=radio], #layered_form select").live("change",function(){reloadContent()}),$("#layered_form input.layered_input_range").live("keyup",function(){$(this).attr("timeout_id")&&window.clearTimeout($(this).attr("timeout_id"));var e=this;$(this).attr("timeout_id",window.setTimeout(function(t){$(t).attr("id")||(t=e);var r=$(t).attr("id").replace(/^layered_(.+)_range_.*$/,"$1"),a=parseInt($("#layered_"+r+"_range_min").val());isNaN(a)&&(a=0),$("#layered_"+r+"_range_min").val(a);var i=parseInt($("#layered_"+r+"_range_max").val());isNaN(i)&&(i=0),$("#layered_"+r+"_range_max").val(i),a>i&&($("#layered_"+r+"_range_max").val($(t).val()),$("#layered_"+r+"_range_min").val($(t).val())),reloadContent()},500,this))}),$("#layered_block_left .radio").live("click",function(){var e=$(this).attr("name");return $.each($(this).parent().parent().find("input[type=button]"),function(t,r){$(r).hasClass("on")&&$(r).attr("name")!=e&&$(r).click()}),!0}),$("#layered_block_left label a").live({click:function(){var e=$(this).parent().parent().find("input").attr("disabled");return(""==e||"undefined"==typeof e||0==e)&&($(this).parent().parent().find("input").click(),reloadContent()),!1}}),layered_hidden_list={},$(".hide-action").live("click",function(){layered_hidden_list[$(this).parent().find("ul").attr("id")]="undefined"==typeof layered_hidden_list[$(this).parent().find("ul").attr("id")]||0==layered_hidden_list[$(this).parent().find("ul").attr("id")]?!0:!1,hideFilterValueAction(this)}),$(".hide-action").each(function(){hideFilterValueAction(this)});for(var e=1;$("#selectPrductSort").length;)$("#selectPrductSort").unbind("change"),$("#selectPrductSort").attr("onchange",""),$("#selectPrductSort").addClass("selectProductSort"),$("#selectPrductSort").attr("id","selectPrductSort"+e),$("label[for=selectPrductSort]").attr("for","selectPrductSort"+e),e++;setTimeout(function(){$(".selectProductSort").unbind("change")},100),$(".selectProductSort").live("change",function(){$(".selectProductSort").val($(this).val()),reloadContent()}),$(".js-nb_item").unbind("change").attr("onchange",""),$(".js-nb_item").live("change",function(){$(".js-nb_item").val($(this).val()),reloadContent()}),paginationButton(),initLayered()});